I, um, the lead dev actually wrote a library for that. I just used his transaction decorator.